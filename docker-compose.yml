services:
  web:
    image: cyberctf/boolean-based-blind-sql-injection:web
    ports:
      - "${WEB_PORT:-3206}:3206"
    environment:
      - WEB_PORT=3206
      - DB_HOST=database
      - DB_PORT=3207
      - DB_NAME=app_repo41
      - DB_USER=app_user
      - DB_PASS=app_password_secure_2024
    depends_on:
      database:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3206/health.php"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
  database:
    image: cyberctf/boolean-based-blind-sql-injection:database
    ports:
      - "${DB_HOST_PORT:-3207}:3207"
    environment:
      - MYSQL_ROOT_PASSWORD=root_password_secure_2024
      - MYSQL_DATABASE=app_repo41
      - TZ=UTC
    healthcheck:
      test: ["CMD-SHELL", "mysqladmin ping -uroot -p\"$MYSQL_ROOT_PASSWORD\" -h 127.0.0.1 -P 3207 || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
